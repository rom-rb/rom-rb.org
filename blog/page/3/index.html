<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="initial-scale=1" name="viewport" /><title>ROM - Blog</title><meta content="summary" name="twitter:card" /><meta content="@rom_rb" name="twitter:site" /><meta content="/blog/page/3/" name="og:url" /><meta content="ROM - Blog" name="og:title" /><meta content="http://rom-rb.org/images/logo--card.png" name="og:image" /><meta content="An open-source persistence and mapping toolkit for Ruby built for speed and simplicity." name="og:description" /><link href="/assets/stylesheets/all.css" rel="stylesheet" /><script src="/assets/javascripts/all.js"></script></head><body class="blog blog_page blog_page_3 blog_page_3_index"><div class="page"><div class="grid"><header class="header"><div class="header__logo"><a href="/" class="header__logo__link">Ruby Object Mapper</a></div><div class="header__menu-toggler" id="navigation__toggler"><span class="fa fa-navicon"></span></div><div class="header__menu" id="navigation__items"><nav class="menu"><ul class="menu__items"><li class="menu__item"><a href="/learn" class="menu__item__link">Learn</a></li><li class="menu__item"><a href="/guides" class="menu__item__link">Guides</a></li><li class="menu__item"><a href="/api" class="menu__item__link">API</a></li><li class="menu__item"><a href="/blog" class="menu__item__link--is-active">Blog</a></li><li class="menu__item"><a href="/contribute" class="menu__item__link">Contribute</a></li><li class="menu__item"><a href="https://discourse.rom-rb.org" class="menu__item__link">Discuss</a></li><li class="menu__item"><a href="/status" class="menu__item__link">Status</a></li><li class="menu__item--last"><a href="https://opencollective.com/rom" class="menu__item__link">Donate</a></li></ul></nav></div></header><div class="page__sidebar"><div class="sidebar"><h2 class="sidebar__header--first">Blog</h2><h3 class="sidebar__header">Latest Posts</h3><ul class="sidebar__items"><li class="sidebar__item"><a href="/blog/rom-5-1-released/" class="sidebar__link">ROM 5.1 released</a></li><li class="sidebar__item"><a href="/blog/announcing-rom-http/" class="sidebar__link">Announcing rom-http</a></li><li class="sidebar__item"><a href="/blog/rom-5-0-and-rom-sql-3-0-released/" class="sidebar__link">rom 5.0.0 and rom-sql 3.0.0 released</a></li><li class="sidebar__item"><a href="/blog/announcing-rom-factory/" class="sidebar__link">Announcing rom-factory</a></li><li class="sidebar__item"><a href="/blog/rom-4-0-released/" class="sidebar__link">ROM 4.0.0 released</a></li></ul><h3 class="sidebar__header">Browse Tags</h3><ul class="sidebar__items"><li class="sidebar__item"><a href="/blog/tags/release" class="sidebar__link">release</a></li><li class="sidebar__item"><a href="/blog/tags/announcement" class="sidebar__link">announcement</a></li><li class="sidebar__item"><a href="/blog/tags/http" class="sidebar__link">http</a></li><li class="sidebar__item"><a href="/blog/tags/repository" class="sidebar__link">repository</a></li><li class="sidebar__item"><a href="/blog/tags/oss" class="sidebar__link">oss</a></li><li class="sidebar__item"><a href="/blog/tags/support" class="sidebar__link">support</a></li></ul><h3 class="sidebar__header">Subscribe</h3><p><a href="#" class="button--secondary"><span class="fa fa-rss"></span> RSS</a></p></div></div><div class="page__content"><div class="content"><article class="article"><h1 class="article__title"><a href="/blog/rom-4-0-released/" class="article__title__link">ROM 4.0.0 released</a></h1><div class="article__metadata">Posted by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> on October 18, 2017 under <ul class="article__tags"><li class="article__tag"><a href="/blog/tags/release">release</a></li><li class="article__tag"><a href="/blog/tags/announcement">announcement</a></li></ul></div><p>After over six months of work, we&#39;re pleased to announce the release of rom-rb 4.0.0! This is a major release which brings many improvements and new features. One of the biggest priorities of this release was to solidify and improve automatic mapping capabilities, by extending core API with features that were previously implemented only in rom-repository. This means that the most advanced features, such as automatic mappers or inferring struct objects, are now part of core API, and it makes using rom-rb much simpler. Apart from this, we also added Association API to the core, which enables associations for all adapters, and you can define associations between different databases.</p>

<p>Here are some of the highlights of 4.0.0 release.</p>
<h2 id="automatic-mapping" class="hd"><a name="automatic-mapping" class="anchor" href="#automatic-mapping">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Automatic mapping</h2>
<p>Starting with 4.0.0, rom-rb can infer mappers on-the-fly for all relations. It can generate mappers for &quot;flat&quot; relations, as well as combined or wrapped relations. You don&#39;t have to use any structs (aka models) to use this feature, it works with plain hashes too.</p>

<p>Let&#39;s say we have users and tasks relations:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span><span class="p">(</span><span class="ss">infer: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">associations</span> <span class="k">do</span>
      <span class="n">has_many</span> <span class="ss">:tasks</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Tasks</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span><span class="p">(</span><span class="ss">infer: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">associations</span> <span class="k">do</span>
      <span class="n">belongs_to</span> <span class="ss">:user</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Now we can load data using these relations easily, including preloaded association data:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="o">&gt;</span> <span class="n">users</span><span class="p">.</span><span class="nf">first</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:id</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="s2">"Jane"</span><span class="p">}</span>

<span class="o">&gt;</span> <span class="n">users</span><span class="p">.</span><span class="nf">combine</span><span class="p">(</span><span class="ss">:tasks</span><span class="p">).</span><span class="nf">first</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:id</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="s2">"Jane"</span><span class="p">,</span> <span class="ss">:tasks</span><span class="o">=&gt;</span><span class="p">[{</span><span class="ss">:id</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="ss">:user_id</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="ss">:title</span><span class="o">=&gt;</span><span class="s2">"Jane's task"</span><span class="p">}]}</span>

<span class="o">&gt;</span> <span class="n">tasks</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="ss">:user</span><span class="p">).</span><span class="nf">first</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:id</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="ss">:user_id</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="ss">:title</span><span class="o">=&gt;</span><span class="s2">"Jane's task"</span><span class="p">,</span> <span class="ss">:user</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:id</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="s2">"Jane"</span><span class="p">}}</span>
</code></pre></div><h2 id="auto-struct-mapping" class="hd"><a name="auto-struct-mapping" class="anchor" href="#auto-struct-mapping">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Auto-struct mapping</h2>
<p>Relations can now automatically infer struct objects based on their schema information. This feature can be enabled via <code>auto_struct</code> setting and <strong>it is enabled by default, when you use relations through repositories</strong>. Let&#39;s tweak previous example to use this feature:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span><span class="p">(</span><span class="ss">infer: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">associations</span> <span class="k">do</span>
      <span class="n">has_many</span> <span class="ss">:tasks</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">auto_struct</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Tasks</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span><span class="p">(</span><span class="ss">infer: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">associations</span> <span class="k">do</span>
      <span class="n">belongs_to</span> <span class="ss">:user</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">auto_struct</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre></div>
<p>Now we will get convenient struct objects back:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="o">&gt;</span> <span class="n">users</span><span class="p">.</span><span class="nf">first</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;ROM::Struct::User id=1 name="Jane"&gt;</span>

<span class="o">&gt;</span> <span class="n">users</span><span class="p">.</span><span class="nf">combine</span><span class="p">(</span><span class="ss">:tasks</span><span class="p">).</span><span class="nf">first</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;ROM::Struct::User id=1 name="Jane" tasks=[#&lt;ROM::Struct::Task id=1 user_id=1 title="Jane's task"&gt;]&gt;</span>

<span class="o">&gt;</span> <span class="n">tasks</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="ss">:user</span><span class="p">).</span><span class="nf">first</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;ROM::Struct::Task id=1 user_id=1 title="Jane's task" user=#&lt;ROM::Struct::User id=1 name="Jane"&gt;&gt;</span>
</code></pre></div><h2 id="support-for-custom-struct-classes" class="hd"><a name="support-for-custom-struct-classes" class="anchor" href="#support-for-custom-struct-classes">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Support for custom struct classes</h2>
<p>This is probably the biggest enhancement, you can now configure your own <code>struct_namespace</code> where your own struct classes are defined, and there&#39;s no need to define attributes. This can be called &quot;Active Record mode&quot; (in a good way!). Resulting struct objects are still decoupled from the database, their structure is based on relation data, which can be projected anyhow you want. This means that we have dynamic struct objects, but without 1:1 mapping between your database schema and their attributes.</p>

<p>Let&#39;s say you decide to put your own struct classes under <code>Entities</code> module. This module can be configured as the <code>struct_namespace</code>, and rom mappers will automatically find classes, matching relation names. Here&#39;s an example:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">module</span> <span class="nn">Entities</span>
  <span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Struct</span>
    <span class="k">def</span> <span class="nf">task_titles</span>
      <span class="n">tasks</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:title</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span><span class="p">(</span><span class="ss">infer: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">associations</span> <span class="k">do</span>
      <span class="n">has_many</span> <span class="ss">:tasks</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">auto_struct</span> <span class="kp">true</span>
  <span class="n">struct_namespace</span> <span class="no">Entities</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Tasks</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span><span class="p">(</span><span class="ss">infer: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">associations</span> <span class="k">do</span>
      <span class="n">belongs_to</span> <span class="ss">:user</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">auto_struct</span> <span class="kp">true</span>
  <span class="n">struct_namespace</span> <span class="no">Entities</span>
<span class="k">end</span>
</code></pre></div>
<p>Now we will get instances of your own struct class:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="o">&gt;</span> <span class="n">jane</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">combine</span><span class="p">(</span><span class="ss">:tasks</span><span class="p">).</span><span class="nf">first</span>
<span class="o">&gt;</span> <span class="n">jane</span><span class="p">.</span><span class="nf">task_titles</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"Jane's task"</span><span class="p">]</span>
</code></pre></div>
<p>You can learn more about this feature <a href="/4.0/learn/core/structs/">in our updated docs</a></p>
<h2 id="standalone-changesets" class="hd"><a name="standalone-changesets" class="anchor" href="#standalone-changesets">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Standalone changesets</h2>
<p>Changesets are now provided by a separate <code>rom-changeset</code> gem and they no longer need repositories. Relations are extended by <code>:changeset</code> plugin, which adds <code>Relation#changeset</code> method. This makes using changesets more straightforward, here&#39;s an example:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">users</span><span class="p">.</span><span class="nf">changeset</span><span class="p">(</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"John"</span><span class="p">).</span><span class="nf">commit</span>
<span class="c1"># {:id=&gt;2, :name=&gt;"John"}</span>

<span class="n">user_changeset</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">by_pk</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">changeset</span><span class="p">(</span><span class="ss">:update</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">)</span>

<span class="n">user_changeset</span><span class="p">.</span><span class="nf">diff?</span>
<span class="c1"># =&gt; true</span>

<span class="n">user_changeset</span><span class="p">.</span><span class="nf">diff</span>
<span class="c1"># =&gt; {:name=&gt;"John Doe"}</span>

<span class="n">user_changeset</span><span class="p">.</span><span class="nf">commit</span>
<span class="c1"># {:id=&gt;2, :name=&gt;"John Doe"}</span>
</code></pre></div>
<p>See <a href="learn/core/changesets/">Changeset documentation for more information</a>.</p>
<h2 id="and-more" class="hd"><a name="and-more" class="anchor" href="#and-more">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>...and more</h2>
<p>There are dozens of other improvements and new features, to quickly summarize few more:</p>

<ul>
<li>Experimental <strong>auto-migration feature</strong> known from DataMapper project - you will hear more about this soon!</li>
<li>You no longer need to define <code>relations</code> in repository classes</li>
<li>You can define custom association views with non-standard combine/join keys</li>
<li>Configuration uses an event bus now, which you can use to hook into setup process and enable additional features. Our plugin system uses it already.</li>
<li>New APIs have been added to rom-sql, including <code>SQL::Relation#exists</code>, <code>SQL::Relation#each_batch</code>, <code>SQL::Relation#import</code> and <code>SQL::Relation#explain</code> (for PG)</li>
<li>SQL conditions can be negated by using idiomatic <code>!</code> operator, ie <code>users.where { !admin.is(true) }</code></li>
</ul>
<h2 id="release-information-and-upgrading" class="hd"><a name="release-information-and-upgrading" class="anchor" href="#release-information-and-upgrading">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Release information and upgrading</h2>
<p>This is a major release with breaking changes. Please refer to <a href="https://github.com/rom-rb/rom/wiki/4.0-Upgrade-Guide">the upgrade guide</a> for more information. As part of 4.0.0, following gems have been released:</p>

<ul>
<li><code>rom-core 4.0.0</code> <a href="https://github.com/rom-rb/rom/blob/main/core/CHANGELOG.md">CHANGELOG</a></li>
<li><code>rom-mapper 1.0.0</code> <a href="https://github.com/rom-rb/rom/blob/main/mapper/CHANGELOG.md">CHANGELOG</a></li>
<li><code>rom-repository 1.0.0</code> <a href="https://github.com/rom-rb/rom/blob/main/repository/CHANGELOG.md">CHANGELOG</a></li>
<li><code>rom-changeset 1.0.0</code> <a href="https://github.com/rom-rb/rom/blob/main/changeset/CHANGELOG.md">CHANGELOG</a></li>
<li><code>rom 4.0.0</code> <a href="https://github.com/rom-rb/rom/blob/main/CHANGELOG.md">CHANGELOG</a> - this is now a meta-gem which depends on all core components</li>
<li><code>rom-sql 2.0.0</code> <a href="https://github.com/rom-rb/rom-sql/blob/main/CHANGELOG.md">CHANGELOG</a></li>
</ul>

<p>If you&#39;re having problems with the upgrade, please seek for help on <a href="https://discourse.rom-rb.org">discussion forum</a>.</p>
<h2 id="thank-you" class="hd"><a name="thank-you" class="anchor" href="#thank-you">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Thank you :)</h2>
<p>Thank you to all our contributors and supporters. Special thanks go to <a href="https://github.com/flash-gordon">Nikita Shilnikov</a> for his amazing work on making rom-sql better, implementing auto-migrations feature and helping with development of core APIs and addressing issues!</p>

<p>This has been the biggest effort so far, and it&#39;s probably the most important release we&#39;ve had. We&#39;ll continue working on bug-fix and minor upgrades soon (there are already PRs opened with new features!), so stay tuned.</p>

<p>Check out rom-rb 4.0.0 and tell us what you think!</p>
<hr /></article><article class="article"><h1 class="article__title"><a href="/blog/rom-repository-1-1-0-released/" class="article__title__link">rom-repository 1.1.0 released</a></h1><div class="article__metadata">Posted by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> on February 16, 2017 under <ul class="article__tags"><li class="article__tag"><a href="/blog/tags/release">release</a></li><li class="article__tag"><a href="/blog/tags/announcement">announcement</a></li><li class="article__tag"><a href="/blog/tags/repository">repository</a></li></ul></div><p>Today we&#39;ve released a new version of rom-repository which ships with new features and a couple of bug fixes. This release focused on improving auto-mapping capabilities and making it more flexible when you want to use custom mappers.</p>
<h2 id="adjusting-relation-nodes-when-loading-aggregates" class="hd"><a name="adjusting-relation-nodes-when-loading-aggregates" class="anchor" href="#adjusting-relation-nodes-when-loading-aggregates">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Adjusting relation nodes when loading aggregates</h2>
<p>It&#39;s now possible to adjust individual relation nodes when you&#39;re loading aggregates or composing relations manually. This feature allows you to apply additional restrictions, or use custom views, or even set custom mappers on-the-fly.</p>

<p>Let&#39;s say we want to load users with their priority tasks:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">aggregate</span><span class="p">(</span><span class="ss">:tasks</span><span class="p">).</span>
  <span class="nf">node</span><span class="p">(</span><span class="ss">:tasks</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">tasks</span><span class="o">|</span> <span class="n">tasks</span><span class="p">.</span><span class="nf">where</span> <span class="p">{</span> <span class="n">priority</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">}</span>
</code></pre></div>
<p>This also works with deeply nested nodes:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">aggregate</span><span class="p">(</span><span class="ss">orders: :lines</span><span class="p">).</span>
  <span class="nf">node</span><span class="p">(</span><span class="ss">orders: :lines</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">lines</span><span class="o">|</span> <span class="n">lines</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">id: </span><span class="n">line_ids</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div><h2 id="disabling-auto-mapping-to-structs" class="hd"><a name="disabling-auto-mapping-to-structs" class="anchor" href="#disabling-auto-mapping-to-structs">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Disabling auto-mapping to structs</h2>
<p>By default all repositories map plain hashes to <code>ROM::Struct</code> objects, you can now disable this feature. This is useful in situations like mapping to JSON where intermediate objects are simply not needed, or when you want to use custom mappers that require hashes rather than structs.</p>

<p>You can disable mapping to structs using a repo class option:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">UserRepo</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Repository</span><span class="p">[</span><span class="ss">:users</span><span class="p">]</span>
  <span class="n">auto_struct</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">user_repo</span> <span class="o">=</span> <span class="no">UserRepo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">rom</span><span class="p">)</span>
<span class="n">user_repo</span><span class="p">.</span><span class="nf">users</span><span class="p">.</span><span class="nf">to_a</span>
<span class="c1"># [{:id=&gt;1, :name=&gt;"Jane"}]</span>
</code></pre></div>
<p>or when instantiating a repo object:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">user_repo</span> <span class="o">=</span> <span class="no">UserRepo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">rom</span><span class="p">,</span> <span class="ss">auto_struct: </span><span class="kp">false</span><span class="p">)</span>
</code></pre></div>
<p>or at run-time per individual relation:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">UserRepo</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Repository</span><span class="p">[</span><span class="ss">:users</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">user_hashes</span>
    <span class="n">users</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">auto_struct: </span><span class="kp">false</span><span class="p">).</span><span class="nf">to_a</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">user_repo</span> <span class="o">=</span> <span class="no">UserRepo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">rom</span><span class="p">)</span>
<span class="n">user_repo</span><span class="p">.</span><span class="nf">user_hashes</span>
<span class="c1"># [{:id=&gt;1, :name=&gt;"Jane"}]</span>
</code></pre></div><h2 id="improved-support-for-wrapping" class="hd"><a name="improved-support-for-wrapping" class="anchor" href="#improved-support-for-wrapping">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Improved support for wrapping</h2>
<p>Just like <code>combine</code>, <code>wrap</code> now accepts association names. This simplifies loading nested data structures via joins. Here&#39;s a simple example:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">Tasks</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span><span class="p">(</span><span class="ss">infer: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">associations</span> <span class="k">do</span>
      <span class="n">belongs_to</span> <span class="ss">:user</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">TaskRepo</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Repository</span><span class="p">[</span><span class="ss">:tasks</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">with_user</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">tasks</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="ss">:user</span><span class="p">).</span><span class="nf">by_pk</span><span class="p">(</span><span class="nb">id</span><span class="p">).</span><span class="nf">one</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">task_repo</span> <span class="o">=</span> <span class="no">TaskRepo</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">rom</span><span class="p">)</span>

<span class="n">task_repo</span><span class="p">.</span><span class="nf">with_user</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="c1"># #&lt;ROM::Struct[Task] id=1 user_id=1 title="A task" user=#&lt;ROM::Struct[User] id=1 name="Jane"&gt;&gt;</span>
</code></pre></div><h2 id="using-custom-mappers-along-with-auto-mapping" class="hd"><a name="using-custom-mappers-along-with-auto-mapping" class="anchor" href="#using-custom-mappers-along-with-auto-mapping">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Using custom mappers along with auto-mapping</h2>
<p>You can now use <code>auto_map</code> option in <code>map_with</code> method which will apply auto-mapping before applying your own mappers. This is useful in cases where you want to use custom mappers and you want auto-mapping to handle complex structural transformations like merging multiple data sets into nested structures (which is what happens when you compose relations using <code>aggregate</code> or <code>combine</code>).</p>

<p>To enable auto-mapping with custom mappers, simply pass <code>auto_map: true</code> option, this way you don&#39;t have to worry about handling aggregates manually, as your mappers will be applied to already transformed data:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">UserRepo</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Repository</span><span class="p">[</span><span class="ss">:users</span><span class="p">]</span>
  <span class="n">relations</span> <span class="ss">:tasks</span>

  <span class="k">def</span> <span class="nf">custom_mapping</span>
    <span class="n">aggregate</span><span class="p">(</span><span class="ss">:tasks</span><span class="p">).</span>
      <span class="nf">map_with</span><span class="p">(</span><span class="ss">:my_custom_mapper</span><span class="p">,</span> <span class="ss">auto_map: </span><span class="kp">true</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h2 id="release-details" class="hd"><a name="release-details" class="anchor" href="#release-details">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Release Details</h2>
<p>This is a backward compatible upgrade, for more information check out the <a href="https://github.com/rom-rb/rom-repository/blob/main/CHANGELOG.md#v110-2017-02-16">CHANGELOG</a>. If you found any issues, or have trouble upgrading, please <a href="https://github.com/rom-rb/rom-repository">report it</a>.</p>
<hr /></article><ul class="inline-buttons inline-buttons--centered"><li class="inline-buttons__button"><a href="/blog/page/4/" class="button"><span class="fa fa-arrow-left"></span></a></li><li class="inline-buttons__spacer inline-buttons__spacer--wide"><p><strong>3 of 9</strong></p></li><li class="inline-buttons__button inline-buttons__button"><a href="/blog/page/2/" class="button"><span class="fa fa-arrow-right"></span></a></li></ul></div><section class="feedback"><div class="inline-buttons"><a href="https://github.com/rom-rb/rom-rb.org/blob/main/source/blog/index.html.slim" class="button">Edit on GitHub</a><a href="https://github.com/rom-rb/rom-rb.org/issues/new?labels=feedback&amp;assignees=solnic&amp;title=Feedback%20on%20ROM%20-%20Blog" class="button">Provide feedback!</a></div></section></div></div></div><div class="footer"><div class="grid"><div class="footer__content"><h3 class="footer__header">Sponsors</h3><p>We are looking for sustainable sponsorship. If your company is relying
on rom-rb or simply want to see rom-rb evolve faster to meet your requirements,
please consider backing the project through <a href="https://opencollective.com/rom">our campaign on
opencollective.com/rom</a>.</p>
</div><div class="footer__fine-print"><div class="footer__fine-print__copyright"><small>&copy; 2014-2025 Ruby Object Mapper. Design by <a href="https://github.com/angeloashmore">@angeloashmore</a>. Logo by <a href="https://github.com/kapowaz">@kapowaz</a>.</small></div><div class="footer__fine-print__social"><a href="https://github.com/rom-rb/rom" class="footer__fine-print__social__icon"><span class="fa fa-github-alt"></span></a><a href="https://twitter.com/rom_rb" class="footer__fine-print__social__icon--last"><span class="fa fa-twitter"></span></a></div></div></div></div></body></html>