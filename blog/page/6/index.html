<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="initial-scale=1" name="viewport" /><title>ROM - Blog</title><meta content="summary" name="twitter:card" /><meta content="@rom_rb" name="twitter:site" /><meta content="/blog/page/6/" name="og:url" /><meta content="ROM - Blog" name="og:title" /><meta content="http://rom-rb.org/images/logo--card.png" name="og:image" /><meta content="An open-source persistence and mapping toolkit for Ruby built for speed and simplicity." name="og:description" /><link href="/assets/stylesheets/all.css" rel="stylesheet" /><script src="/assets/javascripts/all.js"></script></head><body class="blog blog_page blog_page_6 blog_page_6_index"><div class="sponsorship-banner">Weâ€™re taking ROM to the next level, and we need your help.<a href="https://sponsor.hanamirb.org"><span>Become a patron today</span></a></div><div class="page"><div class="grid"><header class="header"><div class="header__logo"><a href="/" class="header__logo__link">Ruby Object Mapper</a></div><div class="header__menu-toggler" id="navigation__toggler"><span class="fa fa-navicon"></span></div><div class="header__menu" id="navigation__items"><nav class="menu"><ul class="menu__items"><li class="menu__item"><a href="/learn" class="menu__item__link">Learn</a></li><li class="menu__item"><a href="/guides" class="menu__item__link">Guides</a></li><li class="menu__item"><a href="/api" class="menu__item__link">API</a></li><li class="menu__item"><a href="/blog" class="menu__item__link--is-active">Blog</a></li><li class="menu__item"><a href="/contribute" class="menu__item__link">Contribute</a></li><li class="menu__item"><a href="https://discourse.rom-rb.org" class="menu__item__link">Discuss</a></li><li class="menu__item"><a href="/status" class="menu__item__link">Status</a></li><li class="menu__item--last"><a href="https://opencollective.com/rom" class="menu__item__link">Donate</a></li></ul></nav></div></header><div class="page__sidebar"><div class="sidebar"><h2 class="sidebar__header--first">Blog</h2><h3 class="sidebar__header">Latest Posts</h3><ul class="sidebar__items"><li class="sidebar__item"><a href="/blog/rom-5-1-released/" class="sidebar__link">ROM 5.1 released</a></li><li class="sidebar__item"><a href="/blog/announcing-rom-http/" class="sidebar__link">Announcing rom-http</a></li><li class="sidebar__item"><a href="/blog/rom-5-0-and-rom-sql-3-0-released/" class="sidebar__link">rom 5.0.0 and rom-sql 3.0.0 released</a></li><li class="sidebar__item"><a href="/blog/announcing-rom-factory/" class="sidebar__link">Announcing rom-factory</a></li><li class="sidebar__item"><a href="/blog/rom-4-0-released/" class="sidebar__link">ROM 4.0.0 released</a></li></ul><h3 class="sidebar__header">Browse Tags</h3><ul class="sidebar__items"><li class="sidebar__item"><a href="/blog/tags/release" class="sidebar__link">release</a></li><li class="sidebar__item"><a href="/blog/tags/announcement" class="sidebar__link">announcement</a></li><li class="sidebar__item"><a href="/blog/tags/http" class="sidebar__link">http</a></li><li class="sidebar__item"><a href="/blog/tags/repository" class="sidebar__link">repository</a></li><li class="sidebar__item"><a href="/blog/tags/oss" class="sidebar__link">oss</a></li><li class="sidebar__item"><a href="/blog/tags/support" class="sidebar__link">support</a></li></ul><h3 class="sidebar__header">Subscribe</h3><p><a href="#" class="button--secondary"><span class="fa fa-rss"></span> RSS</a></p></div></div><div class="page__content"><div class="content"><article class="article"><h1 class="article__title"><a href="/blog/first-beta-of-rom-1-0-0-has-been-released/" class="article__title__link">First Beta of ROM 1.0.0 Has Been Released</a></h1><div class="article__metadata">Posted by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> on November 24, 2015 under <ul class="article__tags"><li class="article__tag"><a href="/blog/tags/announcement">announcement</a></li></ul></div><p>Exactly a year ago ROM 0.3.0 was released after <a href="http://solnic.eu/2014/10/23/ruby-object-mapper-reboot.html">the reboot of the project was announced</a>, it was a complete rewrite that introduced the new and simplified adapter interface. Since then we&#39;ve come a long way, the community has been growing, rom-rb organization on Github has now 28 projects including 16 adapters.</p>

<p>The core API, which also includes adapter interface, is stabilizing. This means we are coming very close to releasing the final version of rom 1.0.0 and today I&#39;m very happy to announce that its first beta1 was released. Please notice this is the release of the core rom gem - adapters and other extensions remain unstable (in the sem-ver sense).</p>

<p>To ease testing we also released beta versions of minor upgrades of other rom gems so that you can install them from rubygems rather than relying on github sources. Overall the release includes following updates:</p>

<ul>
<li><a href="https://rubygems.org/gems/rom">rom</a> 1.0.0.beta1 <a href="https://github.com/rom-rb/rom/blob/main/CHANGELOG.md#v100-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-support">rom-support</a> 1.0.0.beta1 <a href="https://github.com/rom-rb/rom-support/blob/main/CHANGELOG.md#v100-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-mapper">rom-mapper</a> 0.3.0.beta1 <a href="https://github.com/rom-rb/rom-mapper/blob/main/CHANGELOG.md#v030-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-repository">rom-repository</a> 0.2.0.beta1 <a href="https://github.com/rom-rb/rom-repository/blob/main/CHANGELOG.md#v020-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-sql">rom-sql</a> 0.7.0.beta1 <a href="https://github.com/rom-rb/rom-sql/blob/main/CHANGELOG.md#v070-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-rails">rom-rails</a> 0.6.0.beta1 <a href="https://github.com/rom-rb/rom-rails/blob/main/CHANGELOG.md#v060-to-be-released">CHANGELOG</a></li>
<li><a href="https://rubygems.org/gems/rom-model">rom-model</a> 0.2.0.beta1 <a href="https://github.com/rom-rb/rom-model/blob/main/CHANGELOG.md#020-to-be-released">CHANGELOG</a></li>
</ul>
<h2 id="changes-in-setup-api" class="hd"><a name="changes-in-setup-api" class="anchor" href="#changes-in-setup-api">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Changes In Setup API</h2>
<p>Setting up ROM has been refactored and specific responsibilites have been broken down into smaller, and explicit, objects. Unfortunately it is a breaking change as <code>ROM.setup</code> method is gone. If you&#39;re using ROM with rails, things should continue to work, but if you have a custom rom setup additional actions are required.</p>

<p>This was an important change that resulted in a cleaner API, removed complex logic that used to rely on <code>inheritance</code> hooks to automatically register components and reduced the amount of global state that ROM relies on.</p>

<p>We kept convenience in mind though and introduced a feature that uses dir/file structure to infer components and register them automatically but without the complexity of relying on <code>inheritance</code> hooks.</p>

<p>Here&#39;s an example of a step-by-step setup with explicit registration:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># instead of ROM.setup:</span>
<span class="n">config</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Configuration</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">config</span><span class="p">.</span><span class="nf">register_relation</span><span class="p">(</span><span class="no">Users</span><span class="p">)</span>

<span class="c1"># creates rom container with registered components</span>
<span class="n">container</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">container</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>
<p>Here&#39;s an example of a setup that infers components from dir/file names:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">config</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Configuration</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span>

<span class="c1"># configure auto-registration by providing root path to your components</span>
<span class="c1"># namespacing is turned off</span>
<span class="n">config</span><span class="p">.</span><span class="nf">auto_registration</span><span class="p">(</span><span class="s2">"/path/to/components"</span><span class="p">,</span> <span class="ss">namespace: </span><span class="kp">false</span><span class="p">)</span>

<span class="c1"># assuming there's `/path/to/components/relations/users.rb`</span>
<span class="c1"># which defines `Users` relation class it will be automatically registered</span>

<span class="c1"># creates rom container with registered components</span>
<span class="n">container</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">container</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>
<p>You can also use auto-registration with namespaces, which is turned on by default:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">config</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Configuration</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span>

<span class="c1"># configure auto-registration by providing root path to your components</span>
<span class="c1"># namespacing is turned on by default</span>
<span class="n">config</span><span class="p">.</span><span class="nf">auto_registration</span><span class="p">(</span><span class="s2">"/path/to/components"</span><span class="p">)</span>

<span class="c1"># assuming there's `/path/to/components/relations/users.rb`</span>
<span class="c1"># which defines `Relations::Users` class it will be automatically registered</span>

<span class="c1"># creates rom container with registered components</span>
<span class="n">container</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">container</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>
<p>For a quick-start you can use an in-line style setup DSL:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="p">.</span><span class="nf">container</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/rom'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="ss">:macros</span><span class="p">)</span> <span class="c1"># enable in-line component registration</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
      <span class="n">where</span><span class="p">(</span><span class="ss">id: </span><span class="nb">id</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="c1"># returns registered users relation object</span>
</code></pre></div><h2 id="command-api-improvements" class="hd"><a name="command-api-improvements" class="anchor" href="#command-api-improvements">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Command API Improvements</h2>
<p>Probably the most noticable improvement/feature is the addition of the command graph DSL. The command graph was introduced in 0.9.0 and it allowed you to compose a single command that will be able to persist data coming in a nested structure, similar to <code>nested_attributes_for</code> in ActiveRecord, but more flexible.</p>

<p>This release introduces support for <code>update</code> and <code>delete</code> commands in the graph as well as a new DSL for graph definitions. Here&#39;s an example:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># assuming `rom` is your rom container and you have `create` commands</span>
<span class="c1"># for :users and :books relations</span>
<span class="n">command</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">command</span> <span class="c1"># returns command builder</span>

<span class="c1"># define a command that will persist user data with its book data</span>
<span class="n">create_command</span> <span class="o">=</span> <span class="n">command</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">user: :users</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
  <span class="n">user</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:books</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># call it with a nested input</span>
<span class="n">create_command</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">user: </span><span class="p">{</span>
    <span class="ss">name: </span><span class="s2">"Jane"</span><span class="p">,</span>
    <span class="ss">books: </span><span class="p">[{</span> <span class="ss">title: </span><span class="s2">"Book 1"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">title: </span><span class="s2">"Book 2"</span> <span class="p">}]</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>It also supports <code>update</code> (<code>delete</code> works in the same way):</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># assuming `rom` is your rom container and you have `update` commands</span>
<span class="c1"># for :users and :books relations</span>
<span class="n">command</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">command</span> <span class="c1"># returns command builder</span>

<span class="c1"># define a command that will restrict user by its id and update it</span>
<span class="n">user_update</span> <span class="o">=</span> <span class="n">command</span><span class="p">.</span><span class="nf">restrict</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">users</span><span class="p">,</span> <span class="n">user</span><span class="o">|</span> <span class="n">users</span><span class="p">.</span><span class="nf">by_id</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span> <span class="p">}</span>

<span class="n">update_command</span> <span class="o">=</span> <span class="n">command</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">user: </span><span class="n">user_update</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
  <span class="c1"># define an inner update command for books</span>
  <span class="n">books_update</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">restrict</span><span class="p">(</span><span class="ss">:books</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">books</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">book</span><span class="o">|</span>
    <span class="n">books</span><span class="p">.</span><span class="nf">by_user</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="nf">by_id</span><span class="p">(</span><span class="n">book</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="n">user</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">books: </span><span class="n">books_update</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># call it with a nested input</span>
<span class="n">update_command</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">user: </span><span class="p">{</span>
    <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span>
    <span class="ss">name: </span><span class="s2">"Jane Doe"</span><span class="p">,</span>
    <span class="ss">books: </span><span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Book 1"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Book 2"</span> <span class="p">}]</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>As a bonus, you are free to use all types of commands in the same graph and have complete freedom in defining how specific relations must be restricted for a given command.</p>
<h3 id="new-command-result-api" class="hd"><a name="new-command-result-api" class="anchor" href="#new-command-result-api">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>New Command Result API</h3>
<p>Starting from 1.0.0 you can check whether a command result was successful or not:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">create_command</span> <span class="o">=</span> <span class="n">command</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">user: :users</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
  <span class="n">user</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:books</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">create_command</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="ss">user: </span><span class="p">{</span>
    <span class="ss">name: </span><span class="s2">"Jane"</span><span class="p">,</span>
    <span class="ss">books: </span><span class="p">[{</span> <span class="ss">title: </span><span class="s2">"Book 1"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">title: </span><span class="s2">"Book 2"</span> <span class="p">}]</span>
  <span class="p">}</span>
<span class="p">)</span>

<span class="n">result</span><span class="p">.</span><span class="nf">success?</span> <span class="c1"># true if everything went fine, false otherwise</span>
<span class="n">result</span><span class="p">.</span><span class="nf">failure?</span> <span class="c1"># true if it failed, false otherwise</span>
</code></pre></div><h2 id="relation-api-extensions" class="hd"><a name="relation-api-extensions" class="anchor" href="#relation-api-extensions">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Relation API Extensions</h2>
<p>Early version of rom-repository introduced a couple of plugins that now have become part of the core rom gem. They are opt-in and the adapter developers must decide whether or not it makes sense to enable them for adapter relations.</p>
<h3 id="view" class="hd"><a name="view" class="anchor" href="#view">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>View</h3>
<p>Relation <code>view</code> plugin is a DSL for defining relation views with an explicit header definition. It is typically useful for reusable relation projections that you can easily compose together in repositories.</p>

<p>Here&#39;s a simple example:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">view</span><span class="p">(</span><span class="ss">:listing</span><span class="p">,</span> <span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">])</span> <span class="k">do</span> <span class="o">|*</span><span class="n">order_args</span><span class="o">|</span>
    <span class="nb">select</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="o">*</span><span class="n">order_args</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">listing</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:id</span><span class="p">)</span>
</code></pre></div>
<p>This plugin plays major role in relation composition as it defines the header up-front, which allows repositories to generate mappers automatically, which is very convenient. It is also a nice way of specifying re-usable relation projections which some times may indicate where using an actual database view (assuming your db supports it) could simplify your queries.</p>
<h3 id="key-inference" class="hd"><a name="key-inference" class="anchor" href="#key-inference">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Key Inference</h3>
<p>This simple plugin provides default value for a foreign-key in a relation. It is used for generating relation views used for composition in the repositories.</p>

<p>You can use it too:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">foreign_key</span> <span class="c1"># =&gt; `:user_id`</span>
</code></pre></div><h3 id="defining-default-datasets" class="hd"><a name="defining-default-datasets" class="anchor" href="#defining-default-datasets">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Defining Default Datasets</h3>
<p>It is now possible to not only specify the name of a relation dataset, but also configure it using a block, when you do that your relation will be initialized with whatever that blocks returns, it is executed in the context of the dataset object:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">dataset</span><span class="p">(</span><span class="ss">:people</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">select</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h3 id="mapper-extension" class="hd"><a name="mapper-extension" class="anchor" href="#mapper-extension">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Mapper Extension</h3>
<p>There&#39;s one new feature in the mapper DSL where you can map values from multiple attributes into a new attribute:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">MyMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">attribute</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">from: </span><span class="p">[</span><span class="ss">:city</span><span class="p">,</span> <span class="ss">:street</span><span class="p">,</span> <span class="ss">:zipcode</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">city</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">zipcode</span><span class="o">|</span>
    <span class="s2">"</span><span class="si">#{</span><span class="n">city</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">street</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">zipcode</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h2 id="release-plan" class="hd"><a name="release-plan" class="anchor" href="#release-plan">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Release Plan</h2>
<p>Please try out the beta releases and provide feedback. Once we are sure that it works for everybody we&#39;ll be able to push the first RC and hopefully follow-up with the final 1.0.0 release shortly after the RC. Other gems that are now released as betas will be bumped to final versions and depend on rom 1.0.0 final.</p>

<p>The final release also means a major update of <a href="http://rom-rb.org">rom-rb.org</a> along with a new set of documentation, guides and tutorials. This is still a work in progress and needs help, please <a href="https://rom-rb.zulipchat.com">get in touch</a> if you&#39;re interested in helping out.</p>

<p>Once rom 1.0.0 is out there will be major focus on rom-sql and rom-repository. There&#39;s a plan to <a href="https://github.com/rom-rb/rom-sql/issues/48">improve query DSL</a> in rom-sql and provide full CRUD interface for repositories that should be handy for simple applications.</p>

<p>If you see any issues, please report them in the individual issue trackers on Github or main <a href="https://github.com/rom-rb/rom/issues">rom</a> if you are not sure which gem it relates to.</p>
<hr /></article><article class="article"><h1 class="article__title"><a href="/blog/rom-0-9-0-released/" class="article__title__link">ROM 0.9.0 Released</a></h1><div class="article__metadata">Posted by <a href="https://twitter.com/_solnic_">Piotr Solnica</a> on August 19, 2015 under <ul class="article__tags"><li class="article__tag"><a href="/blog/tags/announcement">announcement</a></li></ul></div><p>We are pleased to announce the release of ROM 0.9.0! This is a big release which focuses on internal clean-up in the core library as a preparation for 1.0.0. For those of you hungry for new features - you won&#39;t be disappointed. As part of this release we are introducing new adapters, new gems extracted from rom and the long awaited high-level interface for ROM called rom-repository.</p>

<p>For notes about upgrading to ROM 0.9.0 please refer to <a href="https://github.com/rom-rb/rom/wiki/Upgrade-Guides">Upgrade Guides</a>.</p>

<p>Gem updates summary:</p>

<ul>
<li>rom 0.9.0 <a href="https://github.com/rom-rb/rom/blob/main/CHANGELOG.md#v090-2015-08-19">CHANGELOG</a></li>
<li>rom-sql 0.6.0 <a href="https://github.com/rom-rb/rom-sql/blob/main/CHANGELOG.md#v060-2015-08-19">CHANGELOG</a></li>
<li>rom-yaml 0.2.0 <a href="https://github.com/rom-rb/rom-yaml/blob/main/CHANGELOG.md#v020-2015-08-19">CHANGELOG</a></li>
<li>rom-csv 0.2.0 <a href="https://github.com/rom-rb/rom-csv/blob/main/CHANGELOG.md#v020-2015-08-19">CHANGELOG</a></li>
<li>rom-rails 0.5.0 <a href="https://github.com/rom-rb/rom-rails/blob/main/CHANGELOG.md#v050-2015-08-19">CHANGELOG</a></li>
<li>rom-lotus 0.2.0 <a href="https://github.com/rom-rb/rom-lotus/blob/main/CHANGELOG.md#v020-2015-08-19">CHANGELOG</a></li>
<li>rom-roda 0.2.0 <a href="https://github.com/rom-rb/rom-roda/blob/main/CHANGELOG.md#v020-2015-08-19">CHANGELOG</a></li>
</ul>

<p>New gems:</p>

<ul>
<li><a href="https://github.com/rom-rb/rom-repository">rom-repository</a> 0.1.0 - a higher-level interface with auto-mapping and additional relation plugins</li>
<li><a href="https://github.com/rom-rb/rom-mapper">rom-mapper</a> 0.1.1 - standalone mapper objects extracted from rom</li>
<li><a href="https://github.com/rom-rb/rom-model">rom-model</a> 0.1.1 - extracted from rom-rails, includes <code>Attributes</code> and <code>Validator</code> extensions</li>
<li><a href="https://github.com/rom-rb/rom-support">rom-support</a> 0.1.0 - a bunch of small extensions reused across all rom gems</li>
</ul>

<p>New adapters:</p>

<ul>
<li><a href="https://github.com/rom-rb/rom-couchdb">rom-couchdb</a> - an adapter for CouchDB</li>
<li><a href="http://github.com/rom-rb/rom-http">rom-http</a> - an abstract HTTP adapter useful for implementing concrete adapters for HTTP APIs</li>
<li><a href="http://github.com/rom-rb/rom-rethinkdb">rom-rethinkdb</a> - an adapter for RethinkDB</li>
</ul>
<h2 id="repository" class="hd"><a name="repository" class="anchor" href="#repository">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Repository</h2>
<p>Probably the most significant addition coming with this release is rom-repository. Using lower-level APIs and configuring mappers manually is tedious in most of the cases that&#39;s why Repository was introduced.</p>

<p>Repository interface is very simple and built on top of Relation and Mapper API. It allows you to easily work with relations and have results automatically mapped to struct-like objects. There are a couple of neat plugins that ship with this gem which make relation composition ridiculously simple.</p>

<p>Repositories work <em>with all adapters</em> which means you can combine data from different data sources.</p>

<p>Here&#39;s an example repository class:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">UserRepository</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Repository</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">relations</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:tasks</span>

  <span class="k">def</span> <span class="nf">with_tasks</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">users</span><span class="p">.</span><span class="nf">by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">).</span><span class="nf">combine_children</span><span class="p">(</span><span class="ss">many: </span><span class="n">tasks</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">user_repo</span><span class="p">.</span><span class="nf">with_tasks</span><span class="p">.</span><span class="nf">to_a</span>
<span class="c1"># [#&lt;ROM::Struct[User] id=1 name="Jane" tasks=[#&lt;ROM::Struct[Task] id=2 user_id=1 title="Jane Task"&gt;]&gt;, #&lt;ROM::Struct[User] id=2 name="Joe" tasks=[#&lt;ROM::Struct[Task] id=1 user_id=2 title="Joe Task"&gt;]&gt;]</span>
</code></pre></div>
<p>Please refer to <a href="http://rom-rb.org/guides/basics/repositories/">Repository Guide</a> for the rationale and more information.</p>
<h2 id="multi-environment-support" class="hd"><a name="multi-environment-support" class="anchor" href="#multi-environment-support">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Multi-Environment Support</h2>
<p>Initially, ROM supported its setup process through a global environment object. This was a good start that worked well with frameworks like Rails that expect globally accessible objects; however, we&#39;re pushing towards removing global state as much as possible.</p>

<p>For that reason in ROM 0.9.0 you can configure the environment as a standalone object, which comes with the benefit of being able to have more than one environment. Why would you want to have many environments? For example for database sharding, or separating components within your application where data comes from different sources and you want to keep them isolated.</p>

<p>Here&#39;s an example of a multi-environment setup:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">Persistence::Command::CreateUser</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Commands</span><span class="o">::</span><span class="no">Create</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">relation</span> <span class="ss">:users</span>
  <span class="n">register_as</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Persistence::Query::Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">dataset</span> <span class="ss">:users</span>
<span class="k">end</span>

<span class="n">command_env</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Environment</span><span class="p">.</span><span class="nf">new</span>

<span class="n">command_env</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span><span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://command_host/my_db'</span><span class="p">)</span>
<span class="n">command_env</span><span class="p">.</span><span class="nf">register_relation</span><span class="p">(</span><span class="no">Persistence</span><span class="o">::</span><span class="no">Command</span><span class="o">::</span><span class="no">CreateUser</span><span class="p">)</span>

<span class="n">command_container</span> <span class="o">=</span> <span class="n">command_env</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">command_container</span><span class="p">.</span><span class="nf">command</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="c1"># access to defined commands</span>

<span class="n">query_env</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Environment</span><span class="p">.</span><span class="nf">new</span>

<span class="n">query_env</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span><span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://query_host/my_db'</span><span class="p">)</span>
<span class="n">query_env</span><span class="p">.</span><span class="nf">register_relation</span><span class="p">(</span><span class="no">Persistence</span><span class="o">::</span><span class="no">Query</span><span class="o">::</span><span class="no">Users</span><span class="p">)</span>

<span class="n">query_container</span> <span class="o">=</span> <span class="n">query_env</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">query_container</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="c1"># access to defined relations</span>
</code></pre></div>
<p>Global setup process still works, but please refer to <a href="https://github.com/rom-rb/rom/wiki/Upgrade-Guides">upgrade guide</a> if you are using ROM standalone without any framework integration.</p>
<h2 id="gateway-configuration-support" class="hd"><a name="gateway-configuration-support" class="anchor" href="#gateway-configuration-support">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Gateway Configuration Support</h2>
<p>A new interface for configuring individual adapter gateways has been added. For now the only customization you can make is configuring how relation inferrence should work:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># disable inferring relations from schema</span>
<span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span>
  <span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://localhost/db'</span><span class="p">,</span> <span class="ss">infer_relations: </span><span class="kp">false</span>
<span class="p">])</span>

<span class="c1"># cherry-pick which relations should be inferred</span>
<span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span>
  <span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://localhost/db'</span><span class="p">,</span> <span class="ss">inferrable_relations: </span><span class="p">[</span><span class="ss">:users</span><span class="p">,</span> <span class="ss">:tasks</span><span class="p">]</span>
<span class="p">])</span>

<span class="c1"># disallow inferrence for specific relations</span>
<span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="p">[</span>
  <span class="ss">:postgres</span><span class="p">,</span> <span class="s1">'postgres://localhost/db'</span><span class="p">,</span> <span class="ss">not_inferrable_relations: </span><span class="p">[</span><span class="ss">:some_table</span><span class="p">]</span>
<span class="p">])</span>
</code></pre></div>
<p>This feature is useful when you have a big database and you don&#39;t want to use ROM to deal with all of your relations.</p>
<h2 id="extracted-standalone-mappers" class="hd"><a name="extracted-standalone-mappers" class="anchor" href="#extracted-standalone-mappers">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Extracted Standalone Mappers</h2>
<p>You can now install rom-mapper as a standalone gem and use the powerful mapping DSL:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="nb">require</span> <span class="s1">'rom-mapper'</span>

<span class="k">class</span> <span class="nc">PostMapper</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Mapper</span>
  <span class="n">attribute</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">from: </span><span class="s1">'post_title'</span>

  <span class="n">wrap</span> <span class="ss">:author</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">from: </span><span class="s1">'post_author'</span>
    <span class="n">attribute</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">from: </span><span class="s1">'post_author_email'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">post_mapper</span> <span class="o">=</span> <span class="no">PostMapper</span><span class="p">.</span><span class="nf">build</span>

<span class="n">post_mapper</span><span class="p">.</span><span class="nf">call</span><span class="p">([</span>
<span class="p">{</span> <span class="s1">'post_title'</span> <span class="o">=&gt;</span> <span class="s1">'Hello World'</span><span class="p">,</span> <span class="s1">'post_author'</span> <span class="o">=&gt;</span> <span class="s1">'Jane'</span><span class="p">,</span> <span class="s1">'post_author_email'</span> <span class="o">=&gt;</span> <span class="s1">'jane@doe.org'</span> <span class="p">}</span>
<span class="p">])</span>
<span class="c1"># [{:title=&gt;"Hello World", :author=&gt;{:name=&gt;"Jane", :email=&gt;"jane@doe.org"}}]</span>
</code></pre></div>
<p>Mappers are very powerful, make sure to check out the <a href="http://rom-rb.org/guides/basics/mappers/">Mapper Guides</a>.</p>
<h2 id="all-relations-are-lazy" class="hd"><a name="all-relations-are-lazy" class="anchor" href="#all-relations-are-lazy">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>All Relations Are Lazy</h2>
<p>Before 0.9.0, ROM had a separate layer for decorating your relations with a lazy-proxy wrapper. This has caused some confusion and unnecessary complexity, as the relations you defined were not the same thing that the <code>#relation()</code> method returned. It also turned out that implementing rom-repository was more difficult than it should have been.</p>

<p>That&#39;s why in ROM 0.9.0 all relations have lazy interface. It means that every relation method you define is auto-curried:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">by_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="n">where</span><span class="p">(</span><span class="ss">name: </span><span class="nb">name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># assuming your container is called `rom`</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span>

<span class="n">user_by_name</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">by_name</span> <span class="c1"># returns auto-curried relation</span>

<span class="n">user_by_name</span><span class="p">[</span><span class="s1">'Jane'</span><span class="p">].</span><span class="nf">one!</span> <span class="c1"># call later on to apply the required argument</span>
</code></pre></div><h2 id="adapter-query-dsl-is-public" class="hd"><a name="adapter-query-dsl-is-public" class="anchor" href="#adapter-query-dsl-is-public">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Adapter Query DSL is Public</h2>
<p>Starting from ROM 0.9.0, the query interface exposed by individual adapters is public, <strong>but</strong> it is not recommended to use it directly in your application. Relations should be used to encapsulate data access properly and query DSLs should not leak to the application layer.</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># this is considered as a smell</span>
<span class="n">users</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Jane"</span><span class="p">)</span>

<span class="c1"># that's the proper wayâ„¢</span>
<span class="n">users</span><span class="p">.</span><span class="nf">by_name</span><span class="p">(</span><span class="s2">"Jane"</span><span class="p">)</span>
</code></pre></div><h2 id="extracted-model-extensions" class="hd"><a name="extracted-model-extensions" class="anchor" href="#extracted-model-extensions">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Extracted Model Extensions</h2>
<p>A couple of useful extensions have been extracted from the rom-rails gem into rom-model. These are standalone components that are based on Virtus and ActiveModel. We have an ambitious plan to rewrite it in the future on top of more powerful tools. Please refer to rom-model <a href="https://github.com/rom-rb/rom-model#rommodel">README</a> for more information.</p>

<p>Right now you can use <code>Attributes</code> and enhanced <code>Validator</code> objects with nice support for embedded validations:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">AuthorInput</span>
  <span class="kp">include</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Attributes</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span>
  <span class="n">attribute</span> <span class="ss">:email</span><span class="p">,</span> <span class="no">String</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PostInput</span>
  <span class="kp">include</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Attributes</span>

  <span class="n">attribute</span> <span class="ss">:title</span><span class="p">,</span> <span class="no">String</span>
  <span class="n">attribute</span> <span class="ss">:author</span><span class="p">,</span> <span class="no">AuthorInput</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PostValidator</span>
  <span class="kp">include</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Validator</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>

  <span class="n">embedded</span> <span class="ss">:author</span> <span class="k">do</span>
    <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">input</span> <span class="o">=</span> <span class="no">PostInput</span><span class="p">[{</span> <span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">author: </span><span class="p">{</span> <span class="ss">name: </span><span class="s1">'Jane'</span><span class="p">,</span> <span class="ss">email: </span><span class="s1">'jane@doe.org'</span> <span class="p">}</span> <span class="p">}]</span>

<span class="n">validator</span> <span class="o">=</span> <span class="no">PostValidator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="n">validator</span><span class="p">.</span><span class="nf">valid?</span>
</code></pre></div><h2 id="http-adapter" class="hd"><a name="http-adapter" class="anchor" href="#http-adapter">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>HTTP Adapter</h2>
<p>The new, abstract <code>rom-http</code> adapter is a fantastic addition to the growing list of ROM adapters. It gives you a solid foundation for building a custom adapter which needs to talk via HTTP protocol. It&#39;s pretty flexible, and works like any other rom adapter - which means that you can use either the lower-level relation and mapping APIs or set it up with <code>rom-repository</code> and auto-mapping.</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'http'</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:http</span><span class="p">]</span>
  <span class="n">dataset</span> <span class="ss">:users</span>

  <span class="k">def</span> <span class="nf">by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">with_path</span><span class="p">(</span><span class="nb">id</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">rom</span> <span class="o">=</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Environment</span><span class="p">.</span><span class="nf">new</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:http</span><span class="p">,</span> <span class="p">{</span>
  <span class="ss">uri: </span><span class="s1">'http://jsonplaceholder.typicode.com'</span><span class="p">,</span>
  <span class="ss">request_handler: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">HTTP</span><span class="p">.</span><span class="nf">headers</span><span class="p">(</span><span class="n">dataset</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">public_send</span><span class="p">(</span>
      <span class="n">dataset</span><span class="p">.</span><span class="nf">request_method</span><span class="p">,</span>
      <span class="s2">"</span><span class="si">#{</span><span class="n">dataset</span><span class="p">.</span><span class="nf">uri</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">dataset</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">dataset</span><span class="p">.</span><span class="nf">path</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
      <span class="ss">params: </span><span class="n">dataset</span><span class="p">.</span><span class="nf">params</span>
    <span class="p">)</span>
  <span class="p">},</span>
  <span class="ss">response_handler: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">Array</span><span class="p">([</span><span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">)]).</span><span class="nf">flatten</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="n">rom</span><span class="p">.</span><span class="nf">register_relation</span><span class="p">(</span><span class="no">Users</span><span class="p">)</span>

<span class="n">container</span> <span class="o">=</span> <span class="n">rom</span><span class="p">.</span><span class="nf">finalize</span><span class="p">.</span><span class="nf">env</span>

<span class="n">container</span><span class="p">.</span><span class="nf">relation</span><span class="p">(</span><span class="ss">:users</span><span class="p">).</span><span class="nf">by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">to_a</span>
<span class="c1"># =&gt; GET http://jsonplaceholder.typicode.com/users/1 [ Accept: application/json ]</span>
</code></pre></div><h2 id="support-campaign" class="hd"><a name="support-campaign" class="anchor" href="#support-campaign">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Support Campaign</h2>
<p>As announced <a href="https://github.com/rom-rb/rom-model#rommodel">a couple of weeks ago</a>, we&#39;re running a campaign for <a href="http://salt.bountysource.com/teams/rom-rb">sustainable development</a>. We already have people who&#39;ve decided to donate - thank you <strong>so much</strong> for your support.</p>

<p>With ROM 0.9.0 we&#39;re close to the first stable 1.0.0 release, but there&#39;s still a lot to be done. Please consider supporting this great effort.</p>

<p>Please also remember that ROM is a project open for contributions and currently we have 24 repositories under our GitHub organization. There are many adapters looking for maintainers, there are many smaller tasks to do in core libraries, framework integrations and other extensions. Please get in touch if you&#39;re interested in contributing &lt;3.</p>
<h2 id="reporting-issues-and-support" class="hd"><a name="reporting-issues-and-support" class="anchor" href="#reporting-issues-and-support">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Reporting Issues and Support</h2>
<p>All repositories now have their own issue trackers enabled on GitHub. If you find a bug, or have problems using ROM, please report an issue for a specific project. If you&#39;re not sure which project it relates to, just report it in the main <a href="https://github.com/rom-rb/rom/issues">rom issue tracker</a>, and we&#39;ll move it to the right place if needed.</p>

<p>For any random questions and support requests you can talk to us on <a href="https://rom-rb.zulipchat.com">zulip</a>.</p>

<p><s>Last but not least - we&#39;re looking for help in setting up a Discourse instance on DigitalOcean to make it simpler for people to discuss things as an alternative to gitter.</s></p>

<p>We&#39;ve got <a href="http://discourse.rom-rb.org">a discourse</a> instance up and running :)</p>
<h2 id="rom-1-0-0-see-you-at-rossconf" class="hd"><a name="rom-1-0-0-see-you-at-rossconf" class="anchor" href="#rom-1-0-0-see-you-at-rossconf">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>ROM 1.0.0 - See You at ROSSConf!</h2>
<p>In case you missed it, ROM is part of the second edition of <a href="http://www.rossconf.io/event/berlin/">ROSSConf in Berlin</a>, where you&#39;ll have a chance to contribute to the project. We have a crazy plan to release 1.0.0 during the event or at least close all the remaining issues and get an RC out of the door. :)</p>

<p>We&#39;ll be working on the list of issues scheduled for 1.0.0, thus it is important to get as much feedback as possible from <strong>you</strong>.</p>

<p>Please try out ROM 0.9.0. Let us know your thoughts. Report issues, ideas, comments, anything that can help in specifying what should be done for 1.0.0 will be grately appreciated.</p>

<p>Thanks! &lt;3</p>
<hr /></article><ul class="inline-buttons inline-buttons--centered"><li class="inline-buttons__button"><a href="/blog/page/7/" class="button"><span class="fa fa-arrow-left"></span></a></li><li class="inline-buttons__spacer inline-buttons__spacer--wide"><p><strong>6 of 9</strong></p></li><li class="inline-buttons__button inline-buttons__button"><a href="/blog/page/5/" class="button"><span class="fa fa-arrow-right"></span></a></li></ul></div><section class="feedback"><div class="inline-buttons"><a href="https://github.com/rom-rb/rom-rb.org/blob/main/source/blog/index.html.slim" class="button">Edit on GitHub</a><a href="https://github.com/rom-rb/rom-rb.org/issues/new?labels=feedback&amp;assignees=solnic&amp;title=Feedback%20on%20ROM%20-%20Blog" class="button">Provide feedback!</a></div></section></div></div></div><div class="footer"><div class="grid"><div class="footer__fine-print"><div class="footer__fine-print__copyright"><small>&copy; 2014-2025 Ruby Object Mapper. Design by <a href="https://github.com/angeloashmore">@angeloashmore</a>. Logo by <a href="https://github.com/kapowaz">@kapowaz</a>.</small></div><div class="footer__fine-print__social"><a href="https://github.com/rom-rb/rom" class="footer__fine-print__social__icon"><span class="fa fa-github-alt"></span></a><a href="https://twitter.com/rom_rb" class="footer__fine-print__social__icon--last"><span class="fa fa-twitter"></span></a></div></div></div></div></body></html>