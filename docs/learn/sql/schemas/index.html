<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="initial-scale=1" name="viewport" /><title>ROM - Schemas</title><link href="/assets/stylesheets/all.css" rel="stylesheet" /><script src="/assets/javascripts/all.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-2573270-5', 'auto');
ga('send', 'pageview');</script></head><body class="learn learn_sql learn_sql_schemas learn_sql_schemas_index"><div class="page"><div class="grid"><header class="header"><div class="header__logo"><a href="/" class="header__logo__link">Ruby Object Mapper</a></div><div class="header__menu-toggler" id="navigation__toggler"><span class="fa fa-navicon"></span></div><div class="header__menu" id="navigation__items"><nav class="menu"><ul class="menu__items"><li class="menu__item"><a href="/3.0/learn" class="menu__item__link">Learn</a></li><li class="menu__item"><a href="/3.0/guides" class="menu__item__link">Guides</a></li><li class="menu__item"><a href="/api" class="menu__item__link">API</a></li><li class="menu__item"><a href="/blog" class="menu__item__link">Blog</a></li><li class="menu__item"><a href="/contribute" class="menu__item__link">Contribute</a></li><li class="menu__item"><a href="https://discourse.rom-rb.org" class="menu__item__link">Discuss</a></li><li class="menu__item"><a href="/status" class="menu__item__link">Status</a></li><li class="menu__item--last"><a href="https://opencollective.com/rom" class="menu__item__link">Donate</a></li></ul></nav></div></header><div class="page__sidebar"><div class="sidebar"><h3 class="sidebar__version">Version: <select id="sidebar__version-switcher"><option selected="selected" value="/learn/sql/schemas/index.html">3.0</option><option value="/learn/sql/schemas/index.html">current (3.0)</option><option value="/learn/sql/schemas/index.html">next (4.0)</option></select></h3><h2 class="sidebar__header--first">Learn</h2><ul class="sidebar__items"><li class="sidebar__item"><a href="/3.0/learn/introduction/" class="sidebar__link">Introduction</a><ul class="sidebar__sub-items"><li class="sidebar__sub-item"><a href="/3.0/learn/introduction/philosophy/" class="sidebar__sub-link">Philosophy</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/introduction/why/" class="sidebar__sub-link">Why ROM?</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/introduction/overview/" class="sidebar__sub-link">Overview</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/introduction/active-record/" class="sidebar__sub-link">Active Record and ROM</a></li></ul></li><li class="sidebar__item"><a href="/3.0/learn/getting-started/" class="sidebar__link">Getting Started</a><ul class="sidebar__sub-items"><li class="sidebar__sub-item"><a href="/3.0/learn/getting-started/setup-dsl/" class="sidebar__sub-link">Setup DSL</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/getting-started/rails-setup/" class="sidebar__sub-link">Rails Setup</a></li></ul></li><li class="sidebar__item"><a href="/3.0/learn/core/" class="sidebar__link">Core</a><ul class="sidebar__sub-items"><li class="sidebar__sub-item"><a href="/3.0/learn/core/relations/" class="sidebar__sub-link">Relations</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/core/schemas/" class="sidebar__sub-link">Schemas</a></li></ul></li><li class="sidebar__item"><a href="/3.0/learn/repositories/" class="sidebar__link">Repositories</a><ul class="sidebar__sub-items"><li class="sidebar__sub-item"><a href="/3.0/learn/repositories/quick-start/" class="sidebar__sub-link">Quick Start</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/repositories/reading-simple-objects/" class="sidebar__sub-link">Reading Simple Objects</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/repositories/reading-aggregates/" class="sidebar__sub-link">Reading Aggregates</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/repositories/changesets/" class="sidebar__sub-link">Changesets</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/repositories/composing-relations/" class="sidebar__sub-link">Composing Relations</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/repositories/custom-changesets/" class="sidebar__sub-link">Custom Changesets</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/repositories/changeset-transactions/" class="sidebar__sub-link">Changeset Transactions & Associations</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/repositories/writing-aggregates/" class="sidebar__sub-link">Writing Aggregates</a></li></ul></li><li class="sidebar__item"><a href="/3.0/learn/sql/" class="sidebar__link">SQL</a><ul class="sidebar__sub-items"><li class="sidebar__sub-item"><a href="/3.0/learn/sql/relations/" class="sidebar__sub-link">Relations</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/sql/schemas/" class="sidebar__sub-link">Schemas</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/sql/queries/" class="sidebar__sub-link">Queries</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/sql/attributes/" class="sidebar__sub-link">Attributes</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/sql/associations/" class="sidebar__sub-link">Associations</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/sql/joins/" class="sidebar__sub-link">Joins</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/sql/transactions/" class="sidebar__sub-link">Transactions</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/sql/migrations/" class="sidebar__sub-link">Migrations</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/sql/commands/" class="sidebar__sub-link">Commands</a></li></ul></li><li class="sidebar__item"><a href="/3.0/learn/kafka/" class="sidebar__link">Kafka</a></li><li class="sidebar__item"><a href="/3.0/learn/advanced/" class="sidebar__link">Advanced</a><ul class="sidebar__sub-items"><li class="sidebar__sub-item"><a href="/3.0/learn/advanced/explicit-setup/" class="sidebar__sub-link">Explicit Setup</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/advanced/combine/" class="sidebar__sub-link">Combining Relation Results</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/advanced/commands/" class="sidebar__sub-link">Standalone Commands</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/advanced/custom-commands/" class="sidebar__sub-link">Custom Commands</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/advanced/mappers/" class="sidebar__sub-link">Mappers</a></li><li class="sidebar__sub-item"><a href="/3.0/learn/advanced/how-to-build-an-adapter/" class="sidebar__sub-link">Adapters</a></li></ul></li><li class="sidebar__item"><a href="/3.0/learn/glossary/" class="sidebar__link">Glossary</a></li></ul></div></div><div class="page__content"><div class="content"><h1>SQL &raquo; Schemas</h1><p>The SQL adapter adds its own schema types and association declarations to the
built-in <a href="/3.0/learn/core/schemas">Relation Schema</a> feature.</p>

<h2>Inferring Attributes</h2>

<p>If you don&#39;t want to declare all attributes explicitly, you can tell rom-sql to
infer attributes from an existing schema.</p>

<p>Inference will define normal attributes, foreign keys and primary key (even when
it&#39;s a composite primary key).</p>

<p>To infer a schema automatically:</p>
<pre class="syntax ruby"><code><span class="nb">require</span> <span class="s1">'rom-sql'</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span><span class="p">(</span><span class="ss">infer: </span><span class="kp">true</span><span class="p">)</span> <span class="c1"># that's it</span>
<span class="k">end</span>
</code></pre>
<h2>Coercions</h2>

<p>Relations and commands can coerce output and input data automatically based on your schema attributes.
Default attribute types in schemas are used for input coercions in commands, if you want to apply additional
coercions when relations read their data, you can do it via <code>:read</code> type in schema definitions:</p>
<pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">Posts</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span><span class="p">(</span><span class="ss">infer: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:status</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">String</span><span class="p">,</span> <span class="ss">read: </span><span class="no">Types</span><span class="o">.</span><span class="no">Constructor</span><span class="p">(</span><span class="no">Symbol</span><span class="p">,</span> <span class="o">&amp;</span><span class="ss">:to_sym</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">id</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="ss">title: </span><span class="s1">'Hello World'</span><span class="p">,</span> <span class="ss">status: :draft</span><span class="p">)</span>

<span class="n">users</span><span class="p">.</span><span class="nf">by_pk</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">one</span>
<span class="c1"># =&gt; {:id =&gt; 1, :title =&gt; "Hello World", status: :draft }</span>
</code></pre>
<h2>PostgreSQL Types</h2>

<p>When you define relation schema attributes using custom PG types, the values
will be automatically coerced before executing commands, so you don&#39;t have to
handle that yourself.</p>
<pre class="syntax ruby"><code><span class="nb">require</span> <span class="s1">'rom-sql'</span>
<span class="nb">require</span> <span class="s1">'rom/sql/types/pg'</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Relation</span><span class="p">[</span><span class="ss">:sql</span><span class="p">]</span>
  <span class="n">schema</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:meta</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">PG</span><span class="o">::</span><span class="no">JSON</span>
    <span class="n">attribute</span> <span class="ss">:tags</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">PG</span><span class="o">::</span><span class="no">Array</span>
    <span class="n">attribute</span> <span class="ss">:info</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">PG</span><span class="o">::</span><span class="no">Hash</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Users</span><span class="p">.</span><span class="nf">schema</span><span class="p">[</span><span class="ss">:meta</span><span class="p">][{</span> <span class="ss">name: </span><span class="s1">'Jane'</span> <span class="p">}].</span><span class="nf">class</span>
<span class="c1"># Sequel::Postgres::JSONHash</span>

<span class="no">Users</span><span class="p">.</span><span class="nf">schema</span><span class="p">[</span><span class="ss">:meta</span><span class="p">][[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]].</span><span class="nf">class</span>
<span class="c1"># Sequel::Postgres::JSONArray</span>

<span class="no">Users</span><span class="p">.</span><span class="nf">schema</span><span class="p">[</span><span class="ss">:tags</span><span class="p">][</span><span class="sx">%w(red green blue)</span><span class="p">].</span><span class="nf">class</span>
<span class="c1"># Sequel::Postgres::JSONArray</span>

<span class="no">Users</span><span class="p">.</span><span class="nf">schema</span><span class="p">[</span><span class="ss">:info</span><span class="p">][{</span> <span class="ss">some: </span><span class="s1">'info'</span> <span class="p">}].</span><span class="nf">class</span>
<span class="c1"># Sequel::Postgres::JSONHash</span>
</code></pre></div></div></div></div><div class="footer"><div class="grid"><div class="footer__content"><h3 class="footer__header">Sponsors</h3><p>We are looking for sustainable sponsorship. If your company is relying
on rom-rb or simply want to see rom-rb evolve faster to meet your requirements,
please consider backing the project through <a href="https://opencollective.com/rom">our campaign on
opencollective.com/rom</a>.</p>
</div><div class="footer__fine-print"><div class="footer__fine-print__copyright"><small>&copy; 2014-2017 Ruby Object Mapper. Design by <a href="https://github.com/angeloashmore">@angeloashmore</a>. Logo by <a href="https://github.com/kapowaz">@kapowaz</a>.</small></div><div class="footer__fine-print__social"><a href="https://github.com/rom-rb/rom" class="footer__fine-print__social__icon"><span class="fa fa-github-alt"></span></a><a href="https://twitter.com/rom_rb" class="footer__fine-print__social__icon--last"><span class="fa fa-twitter"></span></a></div></div></div></div></body></html>